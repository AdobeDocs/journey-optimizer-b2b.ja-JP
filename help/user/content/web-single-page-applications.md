---
title: 単一ページアプリケーション
description: 単一ページアプリケーション（SPA）の web エクスペリエンスの作成 – Journey Optimizer B2B editionで、ビュートラッキングの設定、動的コンテンツの処理、クライアントサイドナビゲーションの管理を行います。
feature: Channels, Personalization
role: User
badgeBeta: label="ベータ版" type="informative" tooltip="この機能は、現在、限定ベータ版リリース中です"
source-git-commit: e50b6830736bf763d3aae6a58595e868bbac36e0
workflow-type: tm+mt
source-wordcount: '835'
ht-degree: 1%

---

# 単一ページアプリケーション

単一ページアプリケーション（SPA）では、ページ全体の再読み込みを行わずにページコンテンツを動的に更新するので、web パーソナライゼーションに固有の課題が存在します。 Journey Optimizer B2B editionには、SPA パーソナライゼーションを効果的に処理する専用のツールが用意されています。

## SPA について

トリガー従来の複数ページ Web サイトでは、各ナビゲーションでページ全体が読み込まれますが、SPA では、JavaScriptを使用して、1 つのHTML ページを維持しながらコンテンツを動的に更新します。 このアプローチでは、web エクスペリエンスに関するいくつかの考慮事項が作成されます。

* **ページの再読み込みなし** – 従来のページ読み込みイベントをトリガーせずに、コンテンツの変更が発生します。
* **仮想ビュー** - SPA 内の様々な _ビュー_ または _画面_ を、別々のページとして追跡する必要があります。
* **クライアントサイドのルーティング** - JavaScript ルーター（React ルーター、Vue ルーター、Angular ルーターなど）は、サーバーリクエストではなくナビゲーションを処理します。
* **動的 DOM** - ページ要素は、最初のページを読み込んだ後に作成、変更、削除される場合があります。

## SPA サポートの設定

SPA を効果的にパーソナライズするには、ユーザーが仮想ビュー間を移動する際にJourney Optimizer B2B editionが識別できるように、ビュートラッキングを設定する必要があります。

### ビュー宣言の設定

開発チームと協力し、Adobe Web SDKを使用してビューの宣言を実装します。 これらのビュー宣言を使用すると、SPA が新しいビューに移動するたびにビュー情報を指定して `sendEvent` コマンドを呼び出す必要があります。

**実装例：**

```javascript
// When a new view is rendered in your SPA
alloy("sendEvent", {
  "xdm": {
    "web": {
      "webPageDetails": {
        "viewName": "product-detail",
        "URL": window.location.href
      }
    }
  },
  "data": {
    "__adobe": {
      "target": {
        "viewName": "product-detail"
      }
    }
  }
});
```

### 命名規則の表示

アプリケーションの論理構造に一致する、一貫性のあるわかりやすいビュー名を使用します。

| 表示 | 名前の例 |
| ---- | ------------ |
| ホームページ | `home` |
| 製品リスト | `product-list` |
| 製品の詳細 | `product-detail` |
| ショッピングカート | `cart` |
| チェックアウト | `checkout` |
| アカウントダッシュボード | `account-dashboard` |

>[!NOTE]
>
>ビュー名では大文字と小文字が区別されます。 実装では一貫した命名規則（小文字の場合はハイフンを使用することをお勧めします）を使用します。

## SPA の web エクスペリエンスの作成

SPA 用の web エクスペリエンスを作成する際は、次のベストプラクティスを考慮してください。

### ターゲット固有のビュー

* [web チャネル設定 &#x200B;](../admin/configure-channels-web.md) で、SPA ルーティング構造に合わせて URL マッチングルールを設定します。

* 変更を作成する際に、変更を適用するビューを指定します。

* 各ビューに固有の要素をターゲットとする CSS セレクターを使用します。

### 動的コンテンツの処理

多くの場合、SPA は、最初のページレンダリング後にコンテンツを動的に読み込みます。 これらの手法を使用して、変更が正しく適用されていることを確認します。

#### 要素の待機

適用する前にターゲット要素が存在するのを待機するための変更を設定します。

1. 非ビジュアルエディターで、CSS セレクターを使用して変更を追加します。

1. **[!UICONTROL 要素を待機]** を有効にして、最大待機時間を指定します。

1. 変更は、ターゲット要素が DOM に表示されると適用されます。

#### ミューテーションオブザーバーの使用

非常に動的なコンテンツの場合、web SDKには、新しい要素がページに追加されたタイミングを検出するミューテーションオブザーバーが組み込まれています。 これらのオブザーバーは、要素が非同期で読み込まれた場合でも、変更が適用されることを保証します。

### SPA フレームワーク

Journey Optimizer B2B editionの web エクスペリエンスは、一般的な SPA フレームワークと連携します。

| フレームワーク | 注意点 |
| --------- | -------------- |
| **React** | 変更は、React がコンポーネントを DOM にレンダリングした後に適用されます。 ターゲティングにはクラス名またはデータ属性を使用します。 |
| **Angular** | Angularの変化検出が実行された後の Target 要素。 レンダリングする前に、`*ngIf` を使用して要素をターゲティングしないでください。 |
| **Vue.js** | Vue の `nextTick` が要素が DOM 内にあることを確認するのを待ちます。 安定したターゲティングのためには、参照またはカスタム属性を使用します。 |
| **Next.js/Nuxt.js** | SSR/SSG ページの場合は、変更を予想する前に、web SDKのハイドレーションが完了していることを確認してください。 |

## SPA パーソナライゼーションのベストプラクティス

### 安定したセレクターの使用

SPA は、多くの場合、動的なクラス名や ID を生成します（特に CSS-in-JS ソリューションを使用する場合）。 別の方法として、次を使用できます。

* **データ属性** - ターゲット設定する要素にカスタムデータ属性（`data-testid`、`data-section` など）を追加します。
* **セマンティックHTML** - HTML構造とセマンティック要素に基づく Target。
* **ID 属性** – 可能であれば、安定した ID 属性を使用します。

**例：**

```html
<!-- Instead of targeting dynamic class names -->
<button class="css-1a2b3c4d">Sign Up</button>

<!-- Add a stable data attribute -->
<button class="css-1a2b3c4d" data-action="signup">Sign Up</button>
```

**CSS セレクター：** `[data-action="signup"]`

### テストビュー

SPA web エクスペリエンスをテストする場合：

1. 変更が適用されるすべてのビュー間を移動します。

1. 以下を含むユーザーフロー全体をテストします。
   * ビューへの直接ナビゲーション（ディープリンク）
   * SPA 内の他のビューからのナビゲーション
   * ブラウザーの前後のナビゲーション

1. 以前に訪問したビューに戻る際に、変更が再適用されることを確認します。

### ビュー遷移の処理

一部の SPA では、アニメーションやビュー間のトランジションを使用します。 次の点に留意してください。

* **タイミング** - トランジションアニメーションが完了した後に変更が適用されるようにします。
* **要素の表示** – 要素は存在しても、移行中は非表示になる場合があります。
* **ちらつき** – 目に見えるコンテンツの変更を避けるために、変更を早期に適用します。

## トラブルシューティング

SPA デザインの変更を確認する際には、一般的な問題を解決するために次の推奨事項を使用してください。

* **変更が表示されない** – 変更が SPA に表示されない場合：

   1. **ビュートラッキングの確認** – 呼び出しに正しいビュー名 `sendEvent` 含まれていることを確認します。

   1. **要素の存在を検証** – 変更が適用されたときに、ターゲット要素が DOM に含まれていることを確認します。

   1. **セレクターを確認** - CSS セレクターが実際の DOM 構造と一致することを確認します。

   1. **コンソールを確認** – 変更を妨げる可能性のあるJavaScript エラーを探します。

* **変更が短時間表示された後に表示されなくなる** – この問題は、通常、SPA が変更された要素を再レンダリングして置き換える場合に発生します。

   1. レンダー後も安定した状態を保つ、より具体的な CSS セレクターを使用します。

   1. 要素が再作成された際に、ミューテーションオブザーバーが変更を再適用できるようにします。

   1. 開発チームと協力して、ターゲット要素に安定した属性を追加する。

* **変更を複製** – 変更が複数回表示される場合：

   1. ビュートラッキングイベントが、ビュートランジションごとに 1 回だけ発生することを確認します。

   1. 変更がグローバルに適用されるのではなく、特定のビューを対象としていることを確認します。

## 関連トピック

* [Web エクスペリエンスの概要](./web-experiences.md)
* [Web エクスペリエンスデザイン](./web-experience-design.md)
* [Web チャネル設定](../admin/configure-channels-web.md)